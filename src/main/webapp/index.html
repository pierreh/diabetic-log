<!DOCTYPE html> 
<html manifest="diabeticlog-${buildNumber}.appcache">
  <head>
  <title>BM Book</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="icon" href="favicon.ico" sizes="16x16 32x32 64x64 128x128" type="image/vnd.microsoft.icon">
  <link href='dl-icon-114.png' rel='apple-touch-icon-precomposed' />


  <link rel="stylesheet" href="css/jquery.mobile-1.4.1.min.css"/>
  
  
  <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
  
  <script type="text/javascript">

    function gapiInit() {
      diabeticlog.initApi(function() {
          console.log("API initialized");
          if (diabeticlog.isSignedIn()) {
            signedIn(diabeticlog.getUserinfo());
          } else {
            signedOut();
          }
      });
    }

    function signedIn(userinfo) {
        $('#userinfo')
            .html(userinfo.name)
            .show();
        $('#signin').hide();
    }

    function signedOut() {
        $('#userinfo').hide('');
        $('#signin').show();
    }

    function authorize() {
        diabeticlog.authorize(function() {
           if (diabeticlog.isSignedIn()) {
               signedIn(diabeticlog.getUserinfo());
           } else {
               signedOut();
           }
        });
    }
    
    $( document ).on( "mobileinit", function(){
      //$.mobile.page.prototype.options.degradeInputs.date = true; // do this when using the datepicker component
      //$.mobile.page.prototype.options.degradeInputs.time = true;
      //$.mobile.page.prototype.options.degradeInputs.number = true;
    });
    
    $(document).ready(function() {

      signedOut();

      var currentInput = null;

      function showKeypad() {
        var p = $(currentInput).position();
        $('#n_keypad')
          .show('fast');
        $('#navbar').hide();  
      }

      function hideKeypad() {
        currentInput = null;
        $('#n_keypad').hide('fast');
        $('#navbar').show();
      }

      $('#n_keypad').find('a[data-role="button"]').css({display: 'block'});

      $('input[type="number"]').click(function(e){
          currentInput = this;
          showKeypad();
      });
      $('.done').click(function(){
          hideKeypad();
      });
      $('input[type="text"]').click(function(){
          hideKeypad();
      });
      $('textarea').click(function(){
          hideKeypad();
      });
      $('input[type="time"]').click(function(){
          hideKeypad();
      });

      $('.digit').click(function(){
        if (currentInput && !isNaN($(currentInput).val())) {
          if (parseInt($(currentInput).val()) == 0) {
            $(currentInput).val($(this).text());
          } else {
            $(currentInput).val($(currentInput).val() + $(this).text());
          }
          $(currentInput).change();
        }
      });

      $('.decimal').click(function(){
        if (currentInput && !isNaN($(currentInput).val()) && $(currentInput).val().length > 0) {
          $(currentInput).val($(currentInput).val() + '.');
          $(currentInput).change();
        }
      });

      $('.del').click(function(){
        $(currentInput).val($(currentInput).val().substring(0,$(currentInput).val().length - 1));
        $(currentInput).change();
      });
      $('.clear').click(function(){
          $(currentInput).val('');
          $(currentInput).change();
      });
      $('.zero').click(function(){
        if (!isNaN($(currentInput).val())) {
          if (parseInt($(currentInput).val()) != 0) {
            $(currentInput).val($(currentInput).val() + $(this).text());
            $(currentInput).change();
          }
        }
      });

        setTimeout(function(){
            // Hide the address bar!
            window.scrollTo(0, 1);
            var fileref=document.createElement('script')
            fileref.setAttribute("type","text/javascript")
            fileref.setAttribute("src", "https://apis.google.com/js/client.js?onload=gapiInit")
            document.getElementsByTagName("body")[0].appendChild(fileref);
        }, 0);

    });
  </script>

  <script type="text/javascript" src="js/jquery.mobile-1.4.1.min.js"></script>
  <script type="text/javascript" src="js/jquery.binddata.js"></script>

  <style>
        .center {
                text-align: center;
        }
        .center * {
                margin: 0 auto;
        }
		/*disable text selection on buttons*/
		.a {
			-webkit-touch-callout:none;
			-webkit-user-select:none;
			-khtml-user-select:none;
			-moz-user-select:none;
			-ms-user-select:none;
			user-select:none;
			-webkit-tap-highlight-color:rgba(0,0,0,0);
		}
        
  </style>
  
    <script type="text/javascript" src="js/diabeticlog.js"></script>
    <script type="text/javascript" src="js/diabeticlog.api.js"></script>
    <script type="text/javascript" src="js/diabeticlog.syncapi.js"></script>


  </head>
  <body>
  
        <div id="bmentry" data-role="page" data-theme="a">

                <div id="header" data-role="header" data-theme="a">
                        <a href="#" id="btn-earlier" data-icon="arrow-l">Earlier</a>
                        <h1 id="entry-title"></h1>
                        <a href="#" id="btn-later" data-icon="arrow-r">Later</a>
                </div><!-- /header -->

                <div data-role="content">
                        <!--<label for="date" class="ui-hidden-accessible">Date</label>
                        <input type='date' name='date' disabled/>-->
                        <!--<div class="fieldcontain">
                                <input name="mydate" id="mydate" type="date" data-role="datebox"
                                        data-options='{"mode": "calbox", "useImmediate":true, "useButton": false, "useFocus": true, "useInlineBlind": true, "calUsePickers": true, "calNoHeader": true}'>
                        -->
                        <form id="bmentryform" onsubmit="return false;" data-ajax="false">
                                <div class="fieldcontain">
                                        <label for="time" class="ui-hidden-accessible">Time</label>
                                        <input name="time" id="time" type="time" >
                                </div>
                                <!--<label for="tag" class="ui-hidden-accessible">Type</label>
                                <select id="tag" name="tag">
                                        <option value="beforeBreakfast">Glucose</option>
                                        <option value="actrapid">Actrapid</option>
                                        <option value="insulatard">Insulatard</option>
                                        <option value="persona">Persona</option>
                                        <option value="comment">Comment</option>
                                </select>
                                -->
                                <label for="glucose" class="ui-hidden-accessible">Glucose</label>
                                <input type='number' readonly="readonly" step="0.1" min="1.0" id="glucose" name='glucose' placeholder="Glucose" />
                                <label for="actrapid" class="ui-hidden-accessible">Actrapid</label>
                                <input type='number' readonly="readonly" step="0.5" min="0.5" id="actrapid" name='actrapid' placeholder="Actrapid"/>
                                <label for="insulatard" class="ui-hidden-accessible">Insulatard</label>
                                <input type='number' readonly="readonly" min="1" id="insulatard" name='insulatard' placeholder="Insulatard"/>
                                <label for="comments" class="ui-hidden-accessible">Comments</label>
                                <textarea id="comments" name='comments' placeholder="Comments"></textarea>
                        </form>

                </div><!-- /content -->

                <div id="footer" data-role="footer" data-position="fixed" data-theme="a">

                        <table class="ui-bar-a" id="n_keypad" style="display: none; -khtml-user-select: none; width: 100%">
                          <tr>
                             <td><a data-role="button" data-theme="b" class="digit">7</a></td>
                             <td><a data-role="button" data-theme="b" class="digit">8</a></td>
                             <td><a data-role="button" data-theme="b" class="digit">9</a></td>
                             <td><a data-role="button" data-theme="e" class="del">Del</a></td>
                          </tr>
                          <tr>
                             <td><a data-role="button" data-theme="b" class="digit">4</a></td>
                             <td><a data-role="button" data-theme="b" class="digit">5</a></td>
                             <td><a data-role="button" data-theme="b" class="digit">6</a></td>
                             <td><a data-role="button" data-theme="e" class="clear">Clear</a></td>
                          </tr>
                          <tr>
                             <td><a data-role="button" data-theme="b" class="digit">1</a></td>
                             <td><a data-role="button" data-theme="b" class="digit">2</a></td>
                             <td><a data-role="button" data-theme="b" class="digit">3</a></td>
                             <td><a data-role="button" data-theme="e">&nbsp;</a></td>
                          </tr>
                          <tr>
                             <td><a data-role="button" data-theme="e" class="decimal">.</a></td>
                             <td><a data-role="button" data-theme="b" class="zero">0</a></td>
                             <td><a data-role="button" data-theme="e" class="">&nbsp;</a></td>
                             <td><a data-role="button" data-theme="e" class="done">Done</a></td>
                          </tr>
                        </table>

                        <div id="navbar" data-role="navbar">
                        <ul>
                        <li><a href="#" id="btn-save" data-icon="check">Save</a></li>
                        <li><a href="#" id="btn-add" data-icon="plus">Add</a></li>
                        <li><a href="#" id="btn-prev" data-icon="arrow-u">Previous</a></li>
                        <li><a href="#" id="btn-next" data-icon="arrow-d">Next</a></li>
                        </ul>
                        </div>
                        <div id='footer-bottom' class="center">
                                <span id="status"></span>&nbsp;&nbsp;
                                <span id="version">v${project.version}-${buildNumber}</span>&nbsp;&nbsp;
                                <span id="userinfo"></span>
                                <span id="signin"><a href="#" onclick="authorize()">signin</a></span>
                        </div>
                </div><!-- /footer -->
                
        </div><!-- /page -->

        
  </body>
</html>
